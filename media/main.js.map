{
  "version": 3,
  "sources": ["../src/webview/main.ts"],
  "sourcesContent": ["// Webview UI: chat on the left, PNG spaceship on the right, metadata strip.\n// Keep it framework-free to reduce complexity and avoid React overhead.\n\ndeclare function acquireVsCodeApi(): { postMessage: (msg: any) => void };\n\nconst vscode = acquireVsCodeApi();\n\ntype TabId = 'context' | 'gates' | 'system';\n\nlet activeTab: TabId = 'context';\nlet lastContextPackText = '';\nlet lastUserText = '';\nconst messageEls = new Map<string, HTMLElement>();\nconst buildId = String((window as any).__SPACECODE__?.buildId || '');\n\nfunction el<K extends keyof HTMLElementTagNameMap>(tag: K, className?: string): HTMLElementTagNameMap[K] {\n  const node = document.createElement(tag);\n  if (className) node.className = className;\n  return node;\n}\n\nfunction setActiveTab(tab: TabId) {\n  activeTab = tab;\n  for (const btn of document.querySelectorAll<HTMLButtonElement>('[data-tab]')) {\n    btn.classList.toggle('active', btn.dataset.tab === tab);\n  }\n  for (const panel of document.querySelectorAll<HTMLElement>('[data-panel]')) {\n    panel.style.display = panel.dataset.panel === tab ? 'block' : 'none';\n  }\n}\n\nfunction render() {\n  const root = document.getElementById('root');\n  if (!root) return;\n\n  root.innerHTML = '';\n\n  const layout = el('div', 'layout');\n\n  // Left: chat\n  const left = el('div', 'left');\n  const header = el('div', 'header');\n  header.innerHTML = `\n    <div class=\"brand\">SpaceCode</div>\n    <div class=\"headerBtns\">\n      <button id=\"btnContext\">Context Pack</button>\n      <button id=\"btnAskGpt\">Ask GPT</button>\n      <button id=\"btnMastermind\">Mastermind</button>\n      <button id=\"btnRunGates\">Run Gates</button>\n      <button id=\"btnStop\">Stop</button>\n    </div>\n  `;\n\n  const messages = el('div', 'messages');\n  messages.id = 'messages';\n  messages.innerHTML = `\n    <div class=\"msg system\">Welcome. This is the new SpaceCode UI scaffold (no Coordinator yet).</div>\n  `;\n  if (buildId) {\n    // Visible signal that the webview bundle actually refreshed.\n    setTimeout(() => appendSystem(`UI buildId: ${buildId}`), 0);\n  }\n\n  const composer = el('div', 'composer');\n  composer.innerHTML = `\n    <textarea id=\"input\" rows=\"3\" placeholder=\"Describe the task... (prototype in Yard, or dock into ship)\" ></textarea>\n    <div class=\"composerRow\">\n      <select id=\"profile\">\n        <option value=\"yard\">Yard (prototype)</option>\n        <option value=\"scout\">Scout</option>\n        <option value=\"battleship\">Battleship</option>\n      </select>\n      <button id=\"send\">Send</button>\n    </div>\n  `;\n\n  left.appendChild(header);\n  left.appendChild(messages);\n  left.appendChild(composer);\n\n  // Right: ship image + hotspots + metadata\n  const right = el('div', 'right');\n\n  const shipWrap = el('div', 'shipWrap');\n  shipWrap.innerHTML = `\n    <div class=\"shipTitle\">Ship View</div>\n    <div class=\"shipCanvas\">\n      <img id=\"shipImg\" class=\"shipImg\" alt=\"Ship\" />\n      <div class=\"hotspot\" data-sector=\"yard\" style=\"left: 8%; top: 70%; width: 28%; height: 22%;\"></div>\n      <div class=\"hotspot\" data-sector=\"core\" style=\"left: 52%; top: 22%; width: 40%; height: 26%;\"></div>\n      <div class=\"hotspot\" data-sector=\"features\" style=\"left: 40%; top: 54%; width: 48%; height: 30%;\"></div>\n    </div>\n    <div class=\"shipHint\">Replace ship image at media/ship.png (hotspots are placeholders).</div>\n  `;\n\n  const meta = el('div', 'meta');\n  meta.innerHTML = `\n    <div class=\"tabs\">\n      <button data-tab=\"context\" class=\"active\">Context</button>\n      <button data-tab=\"gates\">Gates</button>\n      <button data-tab=\"system\">System</button>\n    </div>\n\n    <div class=\"panel\" data-panel=\"context\" style=\"display:block\">\n      <div class=\"panelTitle\">Prompt Injection Preview</div>\n      <pre id=\"contextText\" class=\"mono\">(Click Context Pack to fetch)</pre>\n    </div>\n\n    <div class=\"panel\" data-panel=\"gates\" style=\"display:none\">\n      <div class=\"panelTitle\">Gates</div>\n      <div class=\"panelBody\">(stub) Compile/tests/duplication/deps results will appear here.</div>\n    </div>\n\n    <div class=\"panel\" data-panel=\"system\" style=\"display:none\">\n      <div class=\"panelTitle\">System Status</div>\n      <div class=\"panelBody\">\n        <div>Coordinator: disconnected (stub)</div>\n        <div>Unity Bridge: disconnected (stub)</div>\n      </div>\n    </div>\n  `;\n\n  right.appendChild(shipWrap);\n  right.appendChild(meta);\n\n  layout.appendChild(left);\n  layout.appendChild(right);\n\n  root.appendChild(layout);\n\n  // Wire events\n  document.getElementById('btnContext')?.addEventListener('click', () => {\n    const profile = (document.getElementById('profile') as HTMLSelectElement | null)?.value || 'yard';\n    vscode.postMessage({ type: 'getContextPack', profile });\n    appendSystem(`Requested Context Pack (profile=${profile})`);\n  });\n\n  document.getElementById('btnAskGpt')?.addEventListener('click', () => {\n    const text = lastUserText;\n    if (!text) {\n      appendSystem('Ask GPT: no user message yet.');\n      return;\n    }\n    appendSystem('Ask GPT: sending last user message...');\n    vscode.postMessage({ type: 'askGpt', text });\n  });\n\n  document.getElementById('btnMastermind')?.addEventListener('click', () => {\n    const text = lastUserText;\n    if (!text) {\n      appendSystem('Mastermind: no user message yet.');\n      return;\n    }\n    appendSystem('Mastermind: starting (Claude -> GPT -> Claude)...');\n    vscode.postMessage({ type: 'mastermind', text });\n  });\n\n  document.getElementById('btnRunGates')?.addEventListener('click', () => {\n    appendSystem('Run Gates: (stub) will trigger Coordinator gates + Unity compile/tests.');\n    setActiveTab('gates');\n  });\n\n  document.getElementById('btnStop')?.addEventListener('click', () => {\n    appendSystem('Stop requested.');\n    vscode.postMessage({ type: 'stop' });\n  });\n\n  document.getElementById('send')?.addEventListener('click', () => {\n    const input = document.getElementById('input') as HTMLTextAreaElement | null;\n    if (!input) return;\n    const text = input.value.trim();\n    if (!text) return;\n\n    lastUserText = text;\n    appendUser(text);\n    input.value = '';\n\n    // The extension will handle calling Claude/GPT. We only show the injected context preview.\n    const ctx = lastContextPackText ? `\\n\\n---\\n${lastContextPackText}` : '';\n    appendSystem(`Sending to Claude...${ctx ? ' (with injected context)' : ''}`);\n    vscode.postMessage({ type: 'chatSend', text });\n  });\n\n  for (const btn of document.querySelectorAll<HTMLButtonElement>('[data-tab]')) {\n    btn.addEventListener('click', () => setActiveTab(btn.dataset.tab as TabId));\n  }\n\n  for (const hs of document.querySelectorAll<HTMLElement>('.hotspot')) {\n    hs.addEventListener('click', () => {\n      const sector = hs.dataset.sector || 'unknown';\n      appendSystem(`Sector selected: ${sector} (stub: will affect Context Pack focus + rules)`);\n    });\n  }\n\n  // Load placeholder ship image (user can replace with AI-generated PNG).\n  const shipImg = document.getElementById('shipImg') as HTMLImageElement | null;\n  if (shipImg) {\n    const shipUrl = (window as any).__SPACECODE__?.shipUrl as string | undefined;\n    if (shipUrl) shipImg.src = shipUrl;\n    shipImg.onerror = () => {\n      shipImg.style.display = 'none';\n    };\n  }\n}\n\nfunction appendMsg(kind: 'user' | 'assistant' | 'system', text: string, id?: string) {\n  const container = document.getElementById('messages');\n  if (!container) return;\n  const msg = el('div', `msg ${kind}`);\n  msg.textContent = text;\n  if (id) messageEls.set(id, msg);\n  container.appendChild(msg);\n  container.scrollTop = container.scrollHeight;\n}\n\nfunction appendUser(text: string) {\n  appendMsg('user', text);\n}\n\nfunction appendAssistant(text: string) {\n  appendMsg('assistant', text);\n}\n\nfunction appendSystem(text: string) {\n  appendMsg('system', text);\n}\n\nwindow.addEventListener('message', (event) => {\n  const message = event.data;\n  switch (message?.type) {\n    case 'reloaded': {\n      appendSystem(`Panel reloaded.`);\n      break;\n    }\n    case 'contextPack': {\n      const pack = message.pack;\n      lastContextPackText = pack?.injectionText || '';\n      const pre = document.getElementById('contextText');\n      if (pre) {\n        pre.textContent = lastContextPackText || '(empty)';\n      }\n      setActiveTab('context');\n      appendSystem('Context Pack updated.');\n      break;\n    }\n    case 'assistantStart': {\n      const id = String(message.id || '');\n      const provider = String(message.provider || 'assistant');\n      appendMsg('assistant', `${provider}: `, id);\n      break;\n    }\n    case 'assistantChunk': {\n      const id = String(message.id || '');\n      const delta = String(message.delta || '');\n      const el = messageEls.get(id);\n      if (el) el.textContent = (el.textContent || '') + delta;\n      break;\n    }\n    case 'assistantEnd': {\n      // no-op for now\n      break;\n    }\n    case 'error': {\n      appendSystem(`Error: ${String(message.message || '')}`);\n      break;\n    }\n    case 'stopped': {\n      appendSystem('Stopped.');\n      break;\n    }\n    case 'pong':\n      appendSystem(`pong: ${message.now}`);\n      break;\n  }\n});\n\nrender();\n"],
  "mappings": "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",
  "names": ["el"]
}
